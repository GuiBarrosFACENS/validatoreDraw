package com.santander.mpa.infra.config;

import com.santander.mpa.app.processor.PlardDatabaseControlProcessorImpl;
import com.santander.mpa.domain.usecase.impl.ProcessReceiverUserCaseImpl;
import com.santander.mpa.infra.dto.PlardMetadataDto;
import java.time.LocalDate;
import lombok.extern.java.Log;
import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.core.Step;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;

@Configuration
@Slf4j
@Log
@ComponentScan(basePackages = "com.santander.mpa")
public class BatchConfiguration {
  private ProcessReceiverUserCaseImpl processReciverUserCase;

  @Bean
  public ProcessReceiverUserCaseImpl processReceiverUserCaseImpl(
      PlardDatabaseControlProcessorImpl plardDatabaseControlProcessorImpl) {
    return new ProcessReceiverUserCaseImpl(plardDatabaseControlProcessorImpl);
  }

  @Bean
  public Step processRecive() {

    System.out.println("Batata");

    // TODO: Carregar dados do Kafka
    // TODO: IMPLEMENT KAFKA RECIVER
    PlardMetadataDto plardMetadataRecived = new PlardMetadataDto();

    plardMetadataRecived.setIdMetadados(1L);
    System.out.println("fixed");

    plardMetadataRecived.setResolution("DADOS RESOLUCAO");
    plardMetadataRecived.setCreatedAt(LocalDate.now());
    plardMetadataRecived.setUpdatedDate(LocalDate.now());

    processReciverUserCase.processReciveDataPlard(plardMetadataRecived);

    return null;
  }

  //  @Bean
  //  public Step processReturn() {
  //
  //    // TODO: IMPLEMENT KAFKA RECIVER
  //    PlardMetadataDto plardMetadataReturned = new PlardMetadataDto();
  //
  //    plardMetadataReturned.setResolution("DADOS RESOLUCAO");
  //    plardMetadataReturned.setCreatedAt(LocalDate.now());
  //    plardMetadataReturned.setUpdatedDate(LocalDate.now());
  //
  //    new ProcessReturnUserCaseImpl()
  //        .processReturnDataPlard(new PlardMetadaMapperImpl().toEntity(plardMetadataReturned));
  //
  //    return null;
  //  }
}


package com.santander.mpa.domain.usecase.impl;

import com.santander.mpa.domain.usecase.PlardDatabaseControlProcessor;
import com.santander.mpa.domain.usecase.ProcessReciverUserCase;
import com.santander.mpa.infra.dto.PlardMetadataDto;
import java.time.LocalDate;

public class ProcessReceiverUserCaseImpl implements ProcessReciverUserCase {

  private final PlardDatabaseControlProcessor plardDatabaseControlProcessor;

  public ProcessReceiverUserCaseImpl(PlardDatabaseControlProcessor plardDatabaseControlProcessor) {
    this.plardDatabaseControlProcessor = plardDatabaseControlProcessor;
  }

  @Override
  public void processReciveDataPlard(PlardMetadataDto plardMetadataDto) {

    boolean existPlardItemInDB =
        plardDatabaseControlProcessor.verifyPlardItemInDB(plardMetadataDto);

    if (existPlardItemInDB) {
      plardMetadataDto.setStatus("processing".toUpperCase());
      plardMetadataDto.setOgigin(plardMetadataDto.getOgigin());
      plardMetadataDto.setCreatedAt(LocalDate.now());
      plardMetadataDto.setPaymentMethod(plardMetadataDto.getPaymentMethod());
    }

    plardDatabaseControlProcessor.saveInDatabase(plardMetadataDto);
  }
}


[INFO] 
[INFO] --- spring-boot:3.2.5:run (default-cli) @ sbr-monetar-plardykconciliat ---
[INFO] Attaching agents: []
Standard Commons Logging discovery in action with spring-jcl: please remove commons-logging.jar from classpath in order to avoid potential conflicts
15:18:42,094 |-INFO in ch.qos.logback.core.joran.spi.ConfigurationWatchList@7a7471ce - URL [jar:file:/C:/Users/X327579/.m2/repository/com/santander/ars/gln-back-arsenal-backend-telemetry-log-starter/3.12.1/gln-back-arsenal-backend-telemetry-log-starter-3.12.1.jar!/logback-spring.xml] is not of type file
15:18:42,157 |-WARN in ch.qos.logback.core.joran.action.IncludeAction - Could not find resource corresponding to [org/springframework/boot/logging/logback/default.xml]
15:18:42,161 |-INFO in ch.qos.logback.core.joran.action.ConversionRuleAction - registering conversion word color with class [org.springframework.boot.logging.logback.ColorConverter]
15:18:42,164 |-INFO in ch.qos.logback.core.joran.action.ConversionRuleAction - registering conversion word color with class [org.springframework.boot.logging.logback.ColorConverter]
15:18:42,167 |-WARN in IfNestedWithinSecondPhaseElementSC - <if> elements cannot be nested within an <appender>, <logger> or <root> element
15:18:42,167 |-WARN in IfNestedWithinSecondPhaseElementSC - See also http://logback.qos.ch/codes.html#nested_if_element
15:18:42,171 |-WARN in IfNestedWithinSecondPhaseElementSC - Element <appender> at line 63 contains a nested <if> element at line 91
15:18:42,230 |-INFO in ch.qos.logback.core.model.processor.AppenderModelHandler - Processing appender named [logToConsole]
15:18:42,230 |-INFO in ch.qos.logback.core.model.processor.AppenderModelHandler - About to instantiate appender of type [ch.qos.logback.core.ConsoleAppender]
15:18:42,236 |-INFO in ch.qos.logback.core.model.processor.ImplicitModelHandler - Assuming default type [ch.qos.logback.classic.encoder.PatternLayoutEncoder] for [encoder] property
15:18:42,264 |-INFO in ch.qos.logback.classic.model.processor.RootLoggerModelHandler - Setting level of ROOT logger to DEBUG
15:18:42,264 |-INFO in ch.qos.logback.core.model.processor.AppenderRefModelHandler - Attaching appender named [logToConsole] to Logger[ROOT]
15:18:42,264 |-INFO in ch.qos.logback.core.model.processor.DefaultProcessor@28276e50 - End of configuration.
15:18:42,265 |-INFO in org.springframework.boot.logging.logback.SpringBootJoranConfigurator@62e70ea3 - Registering current configuration as safe fallback point
            ss
           .NMy`
         .` yMMd.
        .Ny` sMMm-                                              _
        :MMh` +MMN:             /\                             | |
    ./o:`yMMm. /NMmo:.         /  \   _ __ ___  ___ _ __   __ _| |
 -smMMMm` oMMN: oMMMMMmo.     / /\ \ | '__/ __|/ _ \ '_ \ / _` | |
sMMMMMMMd. /NMN+oMMMMMMMN+   / ____ \| |  \__ \  __/ | | | (_| | |
MMMMMMMMMm- :NMMNMMMMMMMMm  /_/    \_\_|  |___/\___|_| |_|\__,_|_| v3.10.0
yMMMMMMMMMN/ yMMMMMMMMMMMo :: Santander BR :: Cloud Native Java ::
 :yNMMMMMMMModMMMMMMMMms.  gln-back-arsenal-backend-archetype-base v3.10.0
   `-+sdmNNNMMNNNdhs+-     Spring Boot 3.2.5 (Java 17.0.7)
15:18:42.319 [-preinit] INFO       o.h.validator.internal.util.Version  :  :  : HV000001: Hibernate Validator 8.0.1.Final
15:18:42.422 [    main] INFO      com.santander.mpa.ArsenalApplication  :  :  : Starting ArsenalApplication using Java 17.0.11 with PID 31360 (C:\Users\X327579\OneDrive - Santander Office 365\ rea de Trabalho\sbr-monetar-plardykconciliat\target\classes started by X327579 in C:\Users\X327579\OneDrive - Santander Office 365\ rea de Trabalho\sbr-monetar-plardykconciliat)
15:18:42.423 [    main] DEBUG     com.santander.mpa.ArsenalApplication  :  :  : Running with Spring Boot v3.2.5, Spring v6.1.6
15:18:42.423 [    main] INFO      com.santander.mpa.ArsenalApplication  :  :  : The following 1 profile is active: "local"
jdbc:postgresql://localhost:5432/postgres
15:18:46.013 [    main] INFO        com.zaxxer.hikari.HikariDataSource  :  :  : ArsenalPool - Starting...
15:18:46.717 [    main] INFO         com.zaxxer.hikari.pool.HikariPool  :  :  : ArsenalPool - Added connection org.postgresql.jdbc.PgConnection@ac4e690
15:18:46.724 [    main] INFO        com.zaxxer.hikari.HikariDataSource  :  :  : ArsenalPool - Start completed.
15:18:47.230 [    main] INFO   o.hibernate.jpa.internal.util.LogHelper  :  :  : HHH000204: Processing PersistenceUnitInfo [name: default]
15:18:47.375 [    main] INFO                     org.hibernate.Version  :  :  : HHH000412: Hibernate ORM core version 6.4.4.Final
15:18:47.435 [    main] INFO     o.h.c.internal.RegionFactoryInitiator  :  :  : HHH000026: Second-level cache disabled
15:18:47.891 [    main] INFO       o.s.o.j.p.SpringPersistenceUnitInfo  :  :  : No LoadTimeWeaver setup: ignoring JPA class transformer
15:18:47.998 [    main] WARN             org.hibernate.orm.deprecation  :  :  : HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
15:18:49.674 [    main] INFO        o.h.e.t.j.p.i.JtaPlatformInitiator  :  :  : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
15:18:49.736 [    main] INFO  j.LocalContainerEntityManagerFactoryBean  :  :  : Initialized JPA EntityManagerFactory for persistence unit 'default'
Standard Commons Logging discovery in action with spring-jcl: please remove commons-logging.jar from classpath in order to avoid potential conflicts
Batata
fixed
15:18:51.424 [    main] WARN  ConfigServletWebServerApplicationContext  :  :  : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'processRecive' defined in class path resource [com/santander/mpa/infra/config/BatchConfiguration.class]: Failed to instantiate [org.springframework.batch.core.Step]: Factory method 'processRecive' threw exception with message: Cannot invoke "com.santander.mpa.domain.usecase.impl.ProcessReceiverUserCaseImpl.processReciveDataPlard(com.santander.mpa.infra.dto.PlardMetadataDto)" because "this.processReciverUserCase" is null
15:18:51.424 [    main] INFO  j.LocalContainerEntityManagerFactoryBean  :  :  : Closing JPA EntityManagerFactory for persistence unit 'default'
15:18:51.427 [    main] INFO        com.zaxxer.hikari.HikariDataSource  :  :  : ArsenalPool - Shutdown initiated...
15:18:51.429 [    main] INFO        com.zaxxer.hikari.HikariDataSource  :  :  : ArsenalPool - Shutdown completed.
15:18:51.480 [    main] ERROR               o.s.boot.SpringApplication  :  :  : Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'processRecive' defined in class path resource [com/santander/mpa/infra/config/BatchConfiguration.class]: Failed to instantiate [org.springframework.batch.core.Step]: Factory method 'processRecive' threw exception with message: Cannot invoke "com.santander.mpa.domain.usecase.impl.ProcessReceiverUserCaseImpl.processReciveDataPlard(com.santander.mpa.infra.dto.PlardMetadataDto)" because "this.processReciverUserCase" is null
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:648)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.santander.mpa.ArsenalApplication.main(ArsenalApplication.java:18)
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.batch.core.Step]: Factory method 'processRecive' threw exception with message: Cannot invoke "com.santander.mpa.domain.usecase.impl.ProcessReceiverUserCaseImpl.processReciveDataPlard(com.santander.mpa.infra.dto.PlardMetadataDto)" because "this.processReciverUserCase" is null
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:177)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:644)
	... 19 common frames omitted
Caused by: java.lang.NullPointerException: Cannot invoke "com.santander.mpa.domain.usecase.impl.ProcessReceiverUserCaseImpl.processReciveDataPlard(com.santander.mpa.infra.dto.PlardMetadataDto)" because "this.processReciverUserCase" is null
	at com.santander.mpa.infra.config.BatchConfiguration.processRecive(BatchConfiguration.java:43)
	at com.santander.mpa.infra.config.BatchConfiguration$$SpringCGLIB$$0.CGLIB$processRecive$0(<generated>)
	at com.santander.mpa.infra.config.BatchConfiguration$$SpringCGLIB$$FastClass$$1.invoke(<generated>)
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258)
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:331)
	at com.santander.mpa.infra.config.BatchConfiguration$$SpringCGLIB$$0.processRecive(<generated>)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:140)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:644)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:485)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1335)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1165)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:562)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
