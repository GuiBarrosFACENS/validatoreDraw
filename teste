package com.santander.mpa.infra.mapper.impl;

import com.santander.domain.command.PositionalFieldProcessor;
import com.santander.extractor.utils.ExtractorAdvice;
import com.santander.mpa.app.dto.InvoicePaymentFileDTO;
import com.santander.mpa.infra.mapper.LineMapper;
import lombok.AllArgsConstructor;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Service;

@Service
@AllArgsConstructor
public class LineMapperImpl implements LineMapper {

    private static final Logger logger = LoggerFactory.getLogger(LineMapperImpl.class);
    private final ExtractorAdvice extractor;

    @Override
    public InvoicePaymentFileDTO convert(String line) {
        logger.info("Processing line: {}", line);

        InvoicePaymentFileDTO obj = new InvoicePaymentFileDTO();
        PositionalFieldProcessor.process(obj, line);
        ExtractorAdvice.put("data.data.mapAttributes.process", "read file");
        extractor.execute("telemetria_log_category");
        return obj;
    }
}

------------

package com.santander.mpa.infra.mapper;

import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.Mockito.verify;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.*;

import com.santander.domain.command.PositionalFieldProcessor;
import com.santander.extractor.utils.ExtractorAdvice;
import com.santander.mpa.app.dto.InvoicePaymentFileDTO;
import com.santander.mpa.infra.mapper.impl.LineMapperImpl;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;


class LineMapperImplTest {

    @Mock
    private ExtractorAdvice extractor;

    @Mock
    private PositionalFieldProcessor positionalFieldProcessor;

    @InjectMocks
    private LineMapperImpl lineMapper;

    private String line;

  @BeforeEach
  void setUp() {
      MockitoAnnotations.openMocks(this);
    line =
        "0330022300001T 61308480130002571        81915600014122401660000013420140520240000000001042740333084800334401660000013420095  001000057680361991WITYAE CUBEMSU GHOUAR                   01300025710000000000000000000000000                      \n";
  }

    @Test
    @Disabled("This test is disabled because some things are missing yet")
    void convert() {
        InvoicePaymentFileDTO result = lineMapper.convert(line);
        assertNotNull(result);
    }

    @Test
    @DisplayName("Should handle null line")
    void shouldHandleNullLine() {
        line = null;
        assertThrows(NullPointerException.class, () -> lineMapper.convert(line));
    }

    @Test
    @DisplayName("Should handle empty line")
    void shouldHandleEmptyLine() {
        line = "";
        assertThrows(StringIndexOutOfBoundsException.class, () -> lineMapper.convert(line));
    }

    @Test
    @DisplayName("Should process line correctly")
    void shouldProcessLineCorrectly() {

        InvoicePaymentFileDTO result = lineMapper.convert(line);

        assertNotNull(result);
        verify(extractor).execute("telemetria_log_category");
        ExtractorAdvice.put(eq("data.data.mapAttributes.process"), eq("read file"));
    }

}
 ta dando erro no primeiro teste 



org.mockito.exceptions.misusing.InvalidUseOfMatchersException: 
Misplaced or misused argument matcher detected here:

-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:71)
-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:71)

You cannot use argument matchers outside of verification or stubbing.
Examples of correct usage of argument matchers:
    when(mock.get(anyInt())).thenReturn(null);
    doThrow(new RuntimeException()).when(mock).someVoidMethod(any());
    verify(mock).someMethod(contains("foo"))

This message may appear after an NullPointerException if the last matcher is returning an object 
like any() but the stubbed method signature expect a primitive argument, in this case,
use primitive alternatives.
    when(mock.get(any())); // bad use, will raise NPE
    when(mock.get(anyInt())); // correct usage use

Also, this error might show up because you use argument matchers with methods that cannot be mocked.
Following methods *cannot* be stubbed/verified: final/private/equals()/hashCode().
Mocking methods declared on non-public parent classes is not supported.


	at com.santander.mpa.infra.mapper.LineMapperImplTest.setUp(LineMapperImplTest.java:37)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)




