
package com.santander.mpa.infra.messageprovider.integration;

import static org.mockito.Mockito.*;

import com.santander.mpa.infra.config.BatchConfiguration;
import org.apache.kafka.clients.producer.ProducerRecord;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Mockito;
import org.springframework.batch.core.BatchStatus;
import org.springframework.batch.core.JobExecution;
import org.springframework.batch.test.JobLauncherTestUtils;
import org.springframework.batch.test.context.SpringBatchTest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.context.annotation.Import;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.junit.jupiter.SpringExtension;

@ExtendWith(SpringExtension.class)
@SpringBootTest
@SpringBatchTest
@ActiveProfiles("test")
@Import(BatchConfiguration.class)
class KafkaProviderMockTest {

  @Autowired private JobLauncherTestUtils jobLauncherTestUtils;

  @MockBean private KafkaTemplate<String, String> kafkaTemplate;

  @Test
  void testJobWithMockedKafka() throws Exception {
    JobExecution jobExecution = jobLauncherTestUtils.launchJob();

    Assertions.assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus());

    verify(kafkaTemplate, times(2)).send(Mockito.any(ProducerRecord.class));
  }
}


---


org.mockito.exceptions.misusing.InvalidUseOfMatchersException:
Misplaced or misused argument matcher detected here:

-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:52)
-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:52)

You cannot use argument matchers outside of verification or stubbing.
Examples of correct usage of argument matchers:
    when(mock.get(anyInt())).thenReturn(null);
    doThrow(new RuntimeException()).when(mock).someVoidMethod(any());
    verify(mock).someMethod(contains("foo"))

This message may appear after an NullPointerException if the last matcher is returning an object
like any() but the stubbed method signature expect a primitive argument, in this case,
use primitive alternatives.
    when(mock.get(any())); // bad use, will raise NPE
    when(mock.get(anyInt())); // correct usage use

Also, this error might show up because you use argument matchers with methods that cannot be mocked.
Following methods *cannot* be stubbed/verified: final/private/equals()/hashCode().
Mocking methods declared on non-public parent classes is not supported.

        at org.springframework.boot.test.mock.mockito.MockDefinition.createMock(MockDefinition.java:158)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.registerMock(MockitoPostProcessor.java:185)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.register(MockitoPostProcessor.java:167)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:141)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:129)
        at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:363)
        at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:197)
        at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:788)
        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:606)
        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
        at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)        at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)
        at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)
        at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1454)
        at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:553)
        at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)
        at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)
        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)
        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)
        at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
        at org.springframework.test.context.web.ServletTestExecutionListener.setUpRequestContextIfNecessary(ServletTestExecutionListener.java:191)
        at org.springframework.test.context.web.ServletTestExecutionListener.prepareTestInstance(ServletTestExecutionListener.java:130)
        at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:260)
        at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)
        at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)
        at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)
        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
        at java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.forEachRemaining(StreamSpliterators.java:310)
        at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:735)
        at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)
        at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:762)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeTestInstancePostProcessors(ClassBasedTestDescriptor.java:377)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$instantiateAndPostProcessTestInstance$6(ClassBasedTestDescriptor.java:290)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.instantiateAndPostProcessTestInstance(ClassBasedTestDescriptor.java:289)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$4(ClassBasedTestDescriptor.java:279)
        at java.base/java.util.Optional.orElseGet(Optional.java:364)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$testInstancesProvider$5(ClassBasedTestDescriptor.java:278)
        at org.junit.jupiter.engine.execution.TestInstancesProvider.getTestInstances(TestInstancesProvider.java:31)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$prepare$0(TestMethodTestDescriptor.java:106)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:105)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.prepare(TestMethodTestDescriptor.java:69)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$prepare$2(NodeTestTask.java:123)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.prepare(NodeTestTask.java:123)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:90)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
        at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
        at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:63)
        at org.junit.platform.surefire.provider.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:132)
        at org.junit.platform.surefire.provider.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:111)
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
11:49:47.288[    main] ERROR               o.s.boot.SpringApplication  :  :  : Application run failed
org.mockito.exceptions.misusing.InvalidUseOfMatchersException:
Misplaced or misused argument matcher detected here:

-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:52)
-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:52)

You cannot use argument matchers outside of verification or stubbing.
Examples of correct usage of argument matchers:
    when(mock.get(anyInt())).thenReturn(null);
    doThrow(new RuntimeException()).when(mock).someVoidMethod(any());
    verify(mock).someMethod(contains("foo"))

This message may appear after an NullPointerException if the last matcher is returning an object
like any() but the stubbed method signature expect a primitive argument, in this case,
use primitive alternatives.
    when(mock.get(any())); // bad use, will raise NPE
    when(mock.get(anyInt())); // correct usage use

Also, this error might show up because you use argument matchers with methods that cannot be mocked.
Following methods *cannot* be stubbed/verified: final/private/equals()/hashCode().
Mocking methods declared on non-public parent classes is not supported.

        at org.springframework.boot.test.mock.mockito.MockDefinition.createMock(MockDefinition.java:158)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.registerMock(MockitoPostProcessor.java:185)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.register(MockitoPostProcessor.java:167)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:141)
        at org.springframework.boot.test.mock.mockito.MockitoPostProcessor.postProcessBeanFactory(MockitoPostProcessor.java:129)
        at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:363)
        at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:197)
        at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:788)
        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:606)
        at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
        at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
        at org.springframework.boot.test.context.SpringBootContextLoader.lambda$loadContext$3(SpringBootContextLoader.java:137)        at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:58)
        at org.springframework.util.function.ThrowingSupplier.get(ThrowingSupplier.java:46)
        at org.springframework.boot.SpringApplication.withHook(SpringApplication.java:1454)
        at org.springframework.boot.test.context.SpringBootContextLoader$ContextLoaderHook.run(SpringBootContextLoader.java:553)
        at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:137)
        at org.springframework.boot.test.context.SpringBootContextLoader.loadContext(SpringBootContextLoader.java:108)
        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:225)
        at org.springframework.test.context.cache.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:152)
        at org.springframework.test.context.support.DefaultTestContext.getApplicationContext(DefaultTestContext.java:130)
        at org.springframework.test.context.web.ServletTestExecutionListener.setUpRequestContextIfNecessary(ServletTestExecutionListener.java:191)
        at org.springframework.test.context.web.ServletTestExecutionListener.prepareTestInstance(ServletTestExecutionListener.java:130)
        at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:260)
        at org.springframework.test.context.junit.jupiter.SpringExtension.postProcessTestInstance(SpringExtension.java:163)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$10(ClassBasedTestDescriptor.java:378)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.executeAndMaskThrowable(ClassBasedTestDescriptor.java:383)
        at org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$invokeTestInstancePostProcessors$11(ClassBasedTestDescriptor.java:378)
        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)


Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 2.044 sec <<< FAILURE! - in com.santander.mpa.infra.messageprovider.integration.KafkaProviderMockTest
testJobWithMockedKafka  Time elapsed: 0 sec  <<< ERROR!
java.lang.IllegalStateException: Failed to load ApplicationContext for [WebMergedContextConfiguration@2f26e423 testClass = com.santander.mpa.infra.messageprovider.integration.KafkaProviderMockTest, locations = [], classes = [com.santander.mpa.ArsenalApplication], contextInitializerClasses = [], activeProfiles = ["test"], propertySourceDescriptors = [], propertySourceProperties = ["org.springframework.boot.test.context.SpringBootTestContextBootstrapper=true"], contextCustomizers = [[ImportsContextCustomizer@38621947 key = [com.santander.mpa.infra.config.BatchConfiguration]], org.springframework.boot.test.context.filter.ExcludeFilterContextCustomizer@15c16f19, org.springframework.boot.test.json.DuplicateJsonObjectContextCustomizerFactory$DuplicateJsonObjectContextCustomizer@6a6d1ff3, org.springframework.boot.test.mock.mockito.MockitoContextCustomizer@2ae41598, org.springframework.boot.test.web.client.TestRestTemplateContextCustomizer@7f93f4c, org.springframework.boot.test.autoconfigure.actuate.observability.ObservabilityContextCustomizerFactory$DisableObservabilityContextCustomizer@1f, org.springframework.boot.test.autoconfigure.properties.PropertyMappingContextCustomizer@0, org.springframework.boot.test.autoconfigure.web.servlet.WebDriverContextCustomizer@52a67293, org.springframework.batch.test.context.BatchTestContextCustomizer@446ed7b2, org.springframework.boot.test.context.SpringBootTestAnnotation@38ff3a7], resourceBasePath = "src/main/webapp", contextLoader = org.springframework.boot.test.context.SpringBootContextLoader, parent = null]
Caused by: org.mockito.exceptions.misusing.InvalidUseOfMatchersException:

Misplaced or misused argument matcher detected here:

-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:52)
-> at com.santander.mpa.infra.mapper.LineMapperImplTest.shouldProcessLineCorrectly(LineMapperImplTest.java:52)

You cannot use argument matchers outside of verification or stubbing.
Examples of correct usage of argument matchers:
    when(mock.get(anyInt())).thenReturn(null);
    doThrow(new RuntimeException()).when(mock).someVoidMethod(any());
    verify(mock).someMethod(contains("foo"))

This message may appear after an NullPointerException if the last matcher is returning an object
like any() but the stubbed method signature expect a primitive argument, in this case,
use primitive alternatives.
    when(mock.get(any())); // bad use, will raise NPE
    when(mock.get(anyInt())); // correct usage use

Also, this error might show up because you use argument matchers with methods that cannot be mocked.
Following methods *cannot* be stubbed/verified: final/private/equals()/hashCode().
Mocking methods declared on non-public parent classes is not supported.


Running com.santander.mpa.infra.messageprovider.integration.KafkaProviderTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0 sec - in com.santander.mpa.infra.messageprovider.integration.KafkaProviderTest
Running com.santander.mpa.infra.messageprovider.unit.KafkaProviderTest
2024-07-19 11:49:47 WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Connection to node -1 (localhost/127.0.0.1:9092) could not be established. Broker may not be available.
2024-07-19 11:49:47 WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Bootstrap broker localhost:9092 (id: -1 rack: null) disconnected
11:49:47.453[#0-0-C-1] WARN    org.apache.kafka.clients.NetworkClient  :  :  : [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Connection to node -1 (localhost/127.0.0.1:9092) could not be established. Broker may not be available.
11:49:47.454[#0-0-C-1] WARN    org.apache.kafka.clients.NetworkClient  :  :  : [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Bootstrap broker localhost:9092 (id: -1 rack: null) disconnected
2024-07-19 11:49:47 INFO  c.s.m.i.m.KafkaProvider - Sending message to Kafka: {"contractId":"031710023000002365","invoiceInfo":{"paymentType":5,"externalReference":"yyyyyyyyyyy"},"paymentDate":"2023-07-14","dueDate":"2024-01-30","paymentAmount":{"amount":90.0,"currency":"BRL","numericCurrency":"986"},"paymentDetails":{"minimumPaymentAmountDTO":null,"accountHolderName":"JOSEDASILVA","franchiseChannelCode":2,"movementDate":"2024-31-01","movementType":"C","recordSize":154,"ourNumberVerifyingDigit":"6","launchCode":1,"documentNumber":12345678901,"assignorCode":12345678,"cmc7BankCheck":"123432409786645324568231211239","creditUnlockDate":"2024-31-01","paymentChannelCode":"ABCD","paymentMethodCode":"5","transactionNsu":"HEWRTDFSHFGYIUYHIOHGJKJH","postType":"B","numericBarCode":"5423452547632335643423214213564675689765342","flagNumber":0,"cardholderName":"string","channelCode":0,"networkCode":"string","correlationId":"string","localOperReference":"string","documentType":"CPF"}}
11:49:47.656[    main] INFO     c.s.m.i.messageprovider.KafkaProvider  :  :  : Sending message to Kafka: {"contractId":"031710023000002365","invoiceInfo":{"paymentType":5,"externalReference":"yyyyyyyyyyy"},"paymentDate":"2023-07-14","dueDate":"2024-01-30","paymentAmount":{"amount":90.0,"currency":"BRL","numericCurrency":"986"},"paymentDetails":{"minimumPaymentAmountDTO":null,"accountHolderName":"JOSEDASILVA","franchiseChannelCode":2,"movementDate":"2024-31-01","movementType":"C","recordSize":154,"ourNumberVerifyingDigit":"6","launchCode":1,"documentNumber":12345678901,"assignorCode":12345678,"cmc7BankCheck":"123432409786645324568231211239","creditUnlockDate":"2024-31-01","paymentChannelCode":"ABCD","paymentMethodCode":"5","transactionNsu":"HEWRTDFSHFGYIUYHIOHGJKJH","postType":"B","numericBarCode":"5423452547632335643423214213564675689765342","flagNumber":0,"cardholderName":"string","channelCode":0,"networkCode":"string","correlationId":"string","localOperReference":"string","documentType":"CPF"}}
2024-07-19 11:49:47 INFO  c.s.m.i.m.KafkaProvider - Sending message to Kafka: {"contractId":"031710023000002365","invoiceInfo":{"paymentType":5,"externalReference":"yyyyyyyyyyy"},"paymentDate":"2023-07-14","dueDate":"2024-01-30","paymentAmount":{"amount":90.0,"currency":"BRL","numericCurrency":"986"},"paymentDetails":{"minimumPaymentAmountDTO":null,"accountHolderName":"JOSEDASILVA","franchiseChannelCode":2,"movementDate":"2024-31-01","movementType":"C","recordSize":154,"ourNumberVerifyingDigit":"6","launchCode":1,"documentNumber":12345678901,"assignorCode":12345678,"cmc7BankCheck":"123432409786645324568231211239","creditUnlockDate":"2024-31-01","paymentChannelCode":"ABCD","paymentMethodCode":"5","transactionNsu":"HEWRTDFSHFGYIUYHIOHGJKJH","postType":"B","numericBarCode":"5423452547632335643423214213564675689765342","flagNumber":0,"cardholderName":"string","channelCode":0,"networkCode":"string","correlationId":"string","localOperReference":"string","documentType":"CPF"}}
11:49:47.683[    main] INFO     c.s.m.i.messageprovider.KafkaProvider  :  :  : Sending message to Kafka: {"contractId":"031710023000002365","invoiceInfo":{"paymentType":5,"externalReference":"yyyyyyyyyyy"},"paymentDate":"2023-07-14","dueDate":"2024-01-30","paymentAmount":{"amount":90.0,"currency":"BRL","numericCurrency":"986"},"paymentDetails":{"minimumPaymentAmountDTO":null,"accountHolderName":"JOSEDASILVA","franchiseChannelCode":2,"movementDate":"2024-31-01","movementType":"C","recordSize":154,"ourNumberVerifyingDigit":"6","launchCode":1,"documentNumber":12345678901,"assignorCode":12345678,"cmc7BankCheck":"123432409786645324568231211239","creditUnlockDate":"2024-31-01","paymentChannelCode":"ABCD","paymentMethodCode":"5","transactionNsu":"HEWRTDFSHFGYIUYHIOHGJKJH","postType":"B","numericBarCode":"5423452547632335643423214213564675689765342","flagNumber":0,"cardholderName":"string","channelCode":0,"networkCode":"string","correlationId":"string","localOperReference":"string","documentType":"CPF"}}
2024-07-19 11:49:47 INFO  c.s.m.i.m.KafkaProvider - Sending message to Kafka: {"contractId":"031710023000002365","invoiceInfo":{"paymentType":5,"externalReference":"yyyyyyyyyyy"},"paymentDate":"2023-07-14","dueDate":"2024-01-30","paymentAmount":{"amount":90.0,"currency":"BRL","numericCurrency":"986"},"paymentDetails":{"minimumPaymentAmountDTO":null,"accountHolderName":"JOSEDASILVA","franchiseChannelCode":2,"movementDate":"2024-31-01","movementType":"C","recordSize":154,"ourNumberVerifyingDigit":"6","launchCode":1,"documentNumber":12345678901,"assignorCode":12345678,"cmc7BankCheck":"123432409786645324568231211239","creditUnlockDate":"2024-31-01","paymentChannelCode":"ABCD","paymentMethodCode":"5","transactionNsu":"HEWRTDFSHFGYIUYHIOHGJKJH","postType":"B","numericBarCode":"5423452547632335643423214213564675689765342","flagNumber":0,"cardholderName":"string","channelCode":0,"networkCode":"string","correlationId":"string","localOperReference":"string","documentType":"CPF"}}
11:49:47.703[    main] INFO     c.s.m.i.messageprovider.KafkaProvider  :  :  : Sending message to Kafka: {"contractId":"031710023000002365","invoiceInfo":{"paymentType":5,"externalReference":"yyyyyyyyyyy"},"paymentDate":"2023-07-14","dueDate":"2024-01-30","paymentAmount":{"amount":90.0,"currency":"BRL","numericCurrency":"986"},"paymentDetails":{"minimumPaymentAmountDTO":null,"accountHolderName":"JOSEDASILVA","franchiseChannelCode":2,"movementDate":"2024-31-01","movementType":"C","recordSize":154,"ourNumberVerifyingDigit":"6","launchCode":1,"documentNumber":12345678901,"assignorCode":12345678,"cmc7BankCheck":"123432409786645324568231211239","creditUnlockDate":"2024-31-01","paymentChannelCode":"ABCD","paymentMethodCode":"5","transactionNsu":"HEWRTDFSHFGYIUYHIOHGJKJH","postType":"B","numericBarCode":"5423452547632335643423214213564675689765342","flagNumber":0,"cardholderName":"string","channelCode":0,"networkCode":"string","correlationId":"string","localOperReference":"string","documentType":"CPF"}}
2024-07-19 11:49:47 ERROR c.s.m.i.m.KafkaProvider - Error sending message to Kafka
org.springframework.kafka.KafkaException: Error sending message to Kafka
        at org.springframework.kafka.core.KafkaTemplate.send(KafkaTemplate.java:576)
        at com.santander.mpa.infra.messageprovider.KafkaProvider.send(KafkaProvider.java:38)
        at com.santander.mpa.infra.messageprovider.unit.KafkaProviderTest.testExceptionHandling(KafkaProviderTest.java:94)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
        at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
        at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
        at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
        at org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:63)
        at org.junit.platform.surefire.provider.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:132)
        at org.junit.platform.surefire.provider.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:111)
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
11:49:47.704[    main] ERROR    c.s.m.i.messageprovider.KafkaProvider  :  :  : Error sending message to Kafka
org.springframework.kafka.KafkaException: Error sending message to Kafka
        at org.springframework.kafka.core.KafkaTemplate.send(KafkaTemplate.java:576)
        at com.santander.mpa.infra.messageprovider.KafkaProvider.send(KafkaProvider.java:38)
        at com.santander.mpa.infra.messageprovider.unit.KafkaProviderTest.testExceptionHandling(KafkaProviderTest.java:94)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
        at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
        at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.349 sec - in com.santander.mpa.infra.messageprovider.unit.KafkaProviderTest
2024-07-19 11:49:48 WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Connection to node -1 (localhost/127.0.0.1:9092) could not be established. Broker may not be available.
2024-07-19 11:49:48 WARN  o.apache.kafka.clients.NetworkClient - [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Bootstrap broker localhost:9092 (id: -1 rack: null) disconnected
11:49:48.307[#0-0-C-1] WARN    org.apache.kafka.clients.NetworkClient  :  :  : [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Connection to node -1 (localhost/127.0.0.1:9092) could not be established. Broker may not be available.
11:49:48.308[#0-0-C-1] WARN    org.apache.kafka.clients.NetworkClient  :  :  : [Consumer clientId=consumer-GRUPO_TESTE-1, groupId=GRUPO_TESTE] Bootstrap broker localhost:9092 (id: -1 rack: null) disconnected

Results :

Tests in error:
  KafkaProviderMockTest.testJobWithMockedKafka » IllegalState Failed to load App...

Tests run: 39, Failures: 0, Errors: 1, Skipped: 1
